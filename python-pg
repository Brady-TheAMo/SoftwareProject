# MAKE SURE PSYCOPG2 IS INSTALLED IN SOME WAY

import psycopg2
from psycopg2 import sql

# Define connection parameters
connection_params = {
    'dbname': 'photon',
    'user': 'student',
    #'password': 'student',
    #'host': 'localhost',
    #'port': '5432'
}

def check_player_exists(cursor, player_id):
    """Check if a player with the given ID exists in the database."""
    cursor.execute("SELECT codename FROM players WHERE id = %s;", (player_id,))
    return cursor.fetchone()  # Returns None if player doesn't exist

def insert_player(cursor, player_id, codename):
    """Insert a new player into the database."""
    cursor.execute("INSERT INTO players (id, codename) VALUES (%s, %s);", (player_id, codename))

try:
    # Connect to PostgreSQL
    conn = psycopg2.connect(**connection_params)
    cursor = conn.cursor()

    for i in range(2):  # Loop twice to get input for two players
        player_id = input(f"Enter Player {i+1} ID: ")

        existing_player = check_player_exists(cursor, player_id)

        if existing_player:
            print(f"Player {player_id} already exists with codename '{existing_player[0]}'.")
        else:
            codename = input("Enter your codename: ")
            insert_player(cursor, player_id, codename)
            print(f"New player added: {player_id} - {codename}")

    # Commit changes
    conn.commit()

    # Display all players
    cursor.execute("SELECT * FROM players;")
    rows = cursor.fetchall()
    print("\nCurrent Players in Database:")
    for row in rows:
        print(row)

except Exception as error:
    print(f"Error connecting to PostgreSQL database: {error}")

finally:
    # Close the cursor and connection
    if cursor:
        cursor.close()
    if conn:
        conn.close()
